<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= video.title %> - <%= title %></title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; }
        .video-player { background: #000; margin-bottom: 20px; }
        .video-info { background: white; padding: 20px; border-radius: 8px; }
        .video-title { font-size: 24px; font-weight: bold; margin-bottom: 10px; }
        .video-stats { color: #666; margin-bottom: 15px; }
        .video-description { line-height: 1.6; }
        .uploader-info { display: flex; align-items: center; margin: 15px 0; }
        .uploader-avatar { width: 40px; height: 40px; border-radius: 50%; background: #ddd; margin-right: 10px; }
        .related-videos { margin-top: 20px; }
        .related-title { font-size: 18px; font-weight: bold; margin-bottom: 15px; }
        .video-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; }
        .video-card { background: white; border-radius: 8px; overflow: hidden; cursor: pointer; }
        .video-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .video-thumbnail { width: 100%; height: 120px; background: #ddd; display: flex; align-items: center; justify-content: center; }
        .video-card-info { padding: 10px; }
        .video-card-title { font-size: 14px; font-weight: bold; margin-bottom: 5px; }
        .video-card-stats { font-size: 12px; color: #666; }
    </style>
</head>
<body>
    <div class="container">
        <!-- ★ Bunny Stream 视频嵌入 ★ -->
        <div style="position: relative; padding-top: 56.25%;">
          <iframe id="bunny-stream-embed"
            src=""
            loading="lazy"
            style="border:none;position:absolute;top:0;left:0;width:100%;height:100%;"
            allow="accelerometer; gyroscope; autoplay; encrypted-media; picture-in-picture"
            allowfullscreen>
          </iframe>
        </div>
        <!-- ★ 视频嵌入结束 ★ -->
        
        <div class="video-info">
            <h1 class="video-title"><%= video.title %></h1>
            <div class="video-stats">
                <span><%= video.views || 0 %> 次播放</span> •
                <span><%= video.likes || 0 %> 点赞</span> •
                <span><%= video.danmakuCount || 0 %> 弹幕</span>
            </div>
            
            <div class="uploader-info">
                <div class="uploader-avatar"></div>
                <div>
                    <div><strong><%= video.up.name || '未知用户' %></strong></div>
                    <div style="font-size: 12px; color: #666;">UP主</div>
                </div>
            </div>
            
            <div class="video-description">
                <%= video.description || '暂无描述' %>
            </div>
        </div>
        
        <% if (relatedVideos && relatedVideos.length > 0) { %>
        <div class="related-videos">
            <h3 class="related-title">相关推荐</h3>
            <div class="video-grid">
                <% relatedVideos.forEach(function(relatedVideo) { %>
                <div class="video-card" onclick="location.href='/video/<%= relatedVideo._id %>'">
                    <div class="video-thumbnail">
                        <span style="color: #999;">封面</span>
                    </div>
                    <div class="video-card-info">
                        <div class="video-card-title"><%= relatedVideo.title %></div>
                        <div class="video-card-stats"><%= relatedVideo.views || 0 %> 播放</div>
                    </div>
                </div>
                <% }); %>
            </div>
        </div>
        <% } %>
        
        <div style="margin-top: 30px; text-align: center;">
            <a href="/" style="color: #1890ff; text-decoration: none;">← 返回首页</a>
        </div>
    </div>
    <script>
      (async function(){
        const iframe=document.getElementById('bunny-stream-embed');
        const bunnyId='<%= video.bunnyId || "" %>';
        if(bunnyId){
          try{
            const res=await fetch(`/api/bunny-embed/${bunnyId}`);
            const data=await res.json();
            if(data.success){iframe.src=data.embedUrl;return;}
          }catch(e){console.error(e);}
        }
        // 回退
        iframe.src='<%= video.embedUrl %>';
      })();
    </script>
</body>
</html>