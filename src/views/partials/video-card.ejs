<%
  // æ ¼å¼åŒ–æ—¶é•¿
  function formatDuration(seconds) {
    if (!seconds || seconds <= 0) return '00:00';
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
  }
  
  // æ ¼å¼åŒ–æ•°å­—
  function formatNumber(num) {
    if (num >= 10000) {
      return (num / 10000).toFixed(1) + 'ä¸‡';
    }
    return num.toString();
  }
  
  // æ ¼å¼åŒ–æ—¥æœŸ
  function formatDate(dateStr) {
    const date = new Date(dateStr);
    const now = new Date();
    const diff = now - date;
    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    
    if (days === 0) return 'ä»Šå¤©';
    if (days === 1) return 'æ˜¨å¤©';
    if (days < 30) return `${days}å¤©å‰`;
    
    return date.toLocaleDateString('zh-CN');
  }

  // è·å–ä¸Šä¼ è€…ä¿¡æ¯
  const uploader = video.uploader || video.uploaderInfo || video.up || null;
  const uploaderUid = uploader ? (uploader.uid || uploader._id) : 'anonymous';
  const uploaderName = uploader ? (uploader.name || uploader.displayName || uploader.username || 'åŒ¿åç”¨æˆ·') : 'åŒ¿åç”¨æˆ·';
  // å¤´åƒåŠŸèƒ½å·²åˆ é™¤
%>

<div class="video-card" data-preview-url="<%= video.previewUrl || '' %>" data-preview-image="<%= video.previewImage || '' %>">
  <!-- è§†é¢‘ç¼©ç•¥å›¾åŒºåŸŸ - ç‚¹å‡»æ’­æ”¾è§†é¢‘ -->
  <div class="video-thumbnail" onclick="location.href='/video/<%= video._id %>'" data-preview="<%= video.previewUrl || '' %>">
    <picture>
      <% if (video.previewImage) { %>
        <source srcset="<%= video.previewImage %>" type="image/webp">
      <% } %>
      <img src="<%= video.previewImage || video.thumbnail || video.coverUrl || '/api/placeholder/video-thumbnail' %>" 
           alt="<%= video.title %>" loading="lazy">
    </picture>
    <div class="video-duration"><%= formatDuration(video.duration) %></div>
    <% if (video.isPremiumOnly || video.category === 'member') { %>
      <div class="premium-badge">ä¼šå‘˜</div>
    <% } else if (video.category === 'paid' || (video.priceCoin && video.priceCoin > 0) || (video.priceCoins && video.priceCoins > 0)) { %>
      <div class="premium-badge">ä»˜è´¹</div>
    <% } %>
  </div>
  
  <!-- è§†é¢‘ä¿¡æ¯åŒºåŸŸ -->
  <div class="video-info">
    <!-- è§†é¢‘æ ‡é¢˜ - ç‚¹å‡»æ’­æ”¾è§†é¢‘ -->
    <h4 class="video-title" title="<%= video.title %>" onclick="location.href='/video/<%= video._id %>'">
      <%= video.title %>
    </h4>
    
    <!-- ä¸Šä¼ è€…ä¿¡æ¯ - ç‚¹å‡»è¿›å…¥ä¸Šä¼ è€…ä¸»é¡µ -->
    <div class="uploader-info" onclick="event.stopPropagation(); location.href='/space/<%= uploaderUid %>'" style="cursor: pointer; margin-bottom: 8px;">
      <div style="display: flex; align-items: center; gap: 6px;">
        <span style="color: #666; font-size: 0.8rem; font-weight: 500;">ğŸ‘¤ <%= uploaderName %></span>
      </div>
    </div>
    
    <!-- è§†é¢‘ç»Ÿè®¡ä¿¡æ¯ -->
    <div class="video-stats">
      <span class="views"><%= formatNumber(video.views) %> æ’­æ”¾</span>
      <span class="danmaku"><%= formatNumber(video.danmakuCount) %> å¼¹å¹•</span>
      <span class="date"><%= formatDate(video.createdAt) %></span>
    </div>
  </div>
</div> 