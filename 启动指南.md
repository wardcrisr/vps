# 🚀 老金优品云存储系统 - 启动指南

## 📋 当前系统状态
- ✅ Backblaze B2 已配置完成
- ✅ 项目代码已就绪
- ✅ 环境配置文件已创建

## 🔧 手动启动步骤

### 第1步：安装依赖包
```bash
npm install aws-sdk b2-cloud-storage dotenv
```

### 第2步：检查环境配置
确认文件 `src/config/production.env` 包含以下配置：
```env
B2_APPLICATION_KEY_ID=0051a2659deecb00000000002
B2_APPLICATION_KEY=K005UImCqtbhZrfth44YhWlVDbsvjFM
B2_BUCKET_NAME=download-service-key
B2_BUCKET_ID=117a1296e5f9ad0e9e7c0b10
B2_ENDPOINT=s3.us-east-005.backblazeb2.com
```

### 第3步：测试B2连接（可选）
```bash
node test-b2.js
```

### 第4步：启动服务器
```bash
node src/app.js
```

## 🎯 预期输出
服务器启动成功后，您应该看到：
```
🚀 Server running at http://localhost:3000
📁 Upload directory: /root/content-distribution/uploads
✅ MongoDB 已连接
✅ Backblaze B2 (S3 API) 已连接
```

## 🌐 访问网站
启动成功后，在浏览器中访问：
```
http://localhost:3000
```

## 🔍 功能测试清单

### 基础功能测试
- [ ] 网站首页能正常加载
- [ ] 用户注册/登录功能
- [ ] 文件上传界面显示

### 云存储功能测试
- [ ] 上传图片文件（会自动上传到B2）
- [ ] 上传视频文件（会自动上传到B2）
- [ ] 查看上传状态（控制台日志）
- [ ] 文件预览功能

### 付费下载功能测试
- [ ] 免费用户下载图片（每日5次限制）
- [ ] VIP升级页面功能
- [ ] 模拟VIP升级成功
- [ ] VIP用户无限下载功能

## 📊 预期日志输出

### 文件上传日志
```
✅ 文件上传成功: example.jpg -> image/2025/01/example-1738028400000-abc123.jpg
✅ 文件 example.jpg 已上传到云端
```

### 下载权限日志
```
✅ 用户下载权限检查通过
✅ 生成下载令牌成功
```

## ❗ 故障排除

### 如果无法启动：
1. 检查依赖是否完整安装：`npm list aws-sdk b2-cloud-storage`
2. 检查MongoDB是否运行：`systemctl status mongodb`
3. 检查端口是否被占用：`netstat -tlnp | grep :3000`

### 如果B2连接失败：
1. 检查网络连接：`ping s3.us-east-005.backblazeb2.com`
2. 验证B2凭证是否正确
3. 确认存储桶权限设置

### 如果上传失败：
1. 检查uploads目录权限：`ls -la uploads/`
2. 查看服务器日志中的错误信息
3. 验证文件大小是否超过限制

## 🎉 成功标志

系统成功运行的标志：
- ✅ 服务器在端口3000启动
- ✅ MongoDB连接成功
- ✅ B2云存储连接成功
- ✅ 文件上传自动转移到云端
- ✅ 下载权限验证正常工作

## 📞 需要帮助？

如果遇到问题，请提供：
1. 服务器启动日志
2. 浏览器控制台错误
3. 具体的错误信息

---

**准备好体验您的专业云存储平台了吗？立即开始！** 🚀 